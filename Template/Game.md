## 巴什博弈

### 概念

巴什博弈是一个双人博弈： 有一堆总数为 $n$ 的物品，2 名玩家轮流从中拿取物品。每次至少拿 1 件，至多拿 $m$ 件，不能不拿，最终将物品拿完者获胜。

### 必胜策略

在这种最终将物品拿完者获胜的巴什博弈中， 当 $(m + 1) | n$ 时后手必胜， 否则先手必胜。

具体方法是， 当 $(m + 1) | n$ 时后手只用保证两人每次取出的物品之和为 $m + 1$， 到最后就是后手胜利了。 否则 （ 即 $n = k * (m + 1) + R (1 \leq m \leq m)$ ）， 先手第一次就拿掉 $R$ 个就能必胜了。

### 变体及其必胜策略

若将规则改为最后取完物品者败， 此时当 $n \% (m + 1) = 1$ 时后手必胜。 具体方法和传统的类似。

### 总结

感觉巴什博弈里一个非常重要的观察就是： 无论先手如何取物品， 后手总能保证两人取出物品的数量和为 $m + 1$。 在此基础上根据胜利条件来确如何是后手必胜态， 其他的就都是先手必胜。

## PN

### 概念

N（Next Player wins the game） 就是先手必胜态， P（Previous Player wins the game） 就是先手必败态。  
对于一个状态， 只要他的所有次态中至少存在一个先手必败态， 那么该状态就是先手必胜态， 否则就是先手必败态。

也就是说：
- N 的次态中至少存在一个 P 态
- P 的次态中全部都是 N 态

## 经典NIM游戏

### 定义

有若干**堆**石子， 每堆石子的数量都是有限的， 合法的移动是：选择一堆石子并从中拿走若干颗石子（不能不拿）。 最先不能移动的输。

### 结论及其证明

设共有 $n$ 堆石子， 其中第 $i$ 堆石子里有 $a_i$ 颗石子。  
定义尼姆和 $nim = \oplus_{i = 1}^{n}a_i $， 即 $a_i$ 的异或和。则当且仅当 $nim = 0$ 时是先手必败态（P）， 其他的都是先手必胜态（N）。

**证明**

> 对于最终的状态（即已经无石子可取了），此时是先手必败态（P）且 $nim = 0$。
> 
> 对于所有非终局的先手必败态（此时 $nim = 0$）， 无论怎么取石子都会导致 $nim \not = 0$。 因为， 假设我取了一次石子后 $a_i$ 变成了 $a_i'(a_i \not = a_i)$， 则 $nim' = nim \oplus a_i \oplus a_i' = 0 \oplus a_i \oplus a_i' = a_i \oplus a_i' \not = 0$。 所以这就满足了 P 的次态中全都是 N 态。
> 
> 对于所有的先手必胜态（此时 $nim \not = 0$）， 我们假设 $nim$ 的二进制的最高位是 $k$， 则一定存在一个 $a_j$ 使得 $a_j$ 的第 $k$ 位也是 1 ， 注意到 $nim \oplus a_j \oplus (a_j \oplus nim) = 0$ 且 $a_j \oplus nim \leq a_j$， 所以我们只用从第 $j$ 堆石子里取石子并剩下 $a_j \oplus nim$ 颗就能达到一个先手必败态（P）， 这种操作是一定存在且合法的。 这就满足了N 的次态中至少存在一个 P 态。


## 阶梯博弈（Staircase Nim）

### 概述

博弈在一列阶梯（从 1 编号且定义第 0 级阶梯为地面）上进行，每级阶梯上都放着若干个石子， 第 $i$ 阶上有 $a_i$ 个。两个人进行博弈，合法的操作是从一个阶梯（不能是地面）上选若干个石子并挪到**前面相邻的**阶梯（可以是地面），不能操作者输。

### 结论及其证明

这个游戏等价于在所有奇数号台阶上进行经典的 Nim 博弈， 把奇数号台阶上的石子移动到偶数号台阶上就相当于取走石子。

**证明**

我们只需要证明在上述转化中 P 态一定只能到达 N 态。

从 P 态开始，可以有如下操作：

1. 将奇数阶的石子移到偶数阶上， 此举就相当于拿走石子造成 N 态。
2. 将偶数阶的石子移到奇数阶（假设是第 $u$ 阶）上， 此操作后（到达次态）， 另一个人可以移走 $u$ 阶上的石子（前一个人移动多少就移动多少）， 这样就保证了下一步（次次态）是 P 态。 所以次态是 N 态。

若在所有的偶数号台阶上进行经典的 Nim 博弈， 则上述不成立，最简单的反例就是只有两个台阶且 $ a_1 = 0,a_2 = 1$， 此时无论如何先手都不能赢。

### 例题

- [POJ 1704 Georgia and Bob](http://poj.org/problem?id=1704)（[题解](Collection.md#Miao-Maio-Problem（喵喵题）##[Georgia-and-Bob](http://poj.org/problem?id=1704)（阶梯博弈）)）
- [hdu 4315 Climbing the Hill](https://acm.hdu.edu.cn/showproblem.php?pid=4315)（题解在上面一道题题解的下一篇）

**PS**  
感觉上面两道题最主要的观察就是找和移动石子等价的操作。

## NimK

### 概述

有若干**堆**石子， 每堆石子的数量都是有限的， 合法的移动是：选择不超过 $k$ 堆石子并从中拿走若干颗石子（不能不拿）。 最先不能移动的输。  
当 $k = 1$时， 以上描述就是经典的 Nim 博弈。

### 结论及其证明

设共有 $n$ 堆石子， 其中第 $i$ 堆石子里有 $a_i$ 颗石子。  
如果这 $n$ 个数中共有 $cnt_x$ 个数第  $x$ 位为 1， 令 $nimk = \sum cnt_x\%(k + 1)$, 则先手必败当且仅当$nimk = 0$ ， 否则先手必胜。  
当 $k = 1$ 时上述表述就是所有的数异或。

**证明**

> 对于最终的状态， 已经没有石子可以取了， 此时 $nimk = 0$ 是先手必败态（P）。
>
> 对于非最终状态的先手必败态， 若想要次态也是 P （即 $nimk = 0$）, 则必须至少在某一位上拿走 $k + 1$ 个 1， 这显然是不可能通过一次操作达成的。
>
> 对于先手必胜态（$nimk \not = 0$）， 则先找最大的 $x$ 使得 $cnt_x \% (k + 1) = m_x > 0$。 则可以任意找 $m_x$ 个第 $x$ 位为 1 的数并把第 $x$ 位上的 1 变成 0。 接下来， 对于下一个二进制位 $t$ 使得 $cnt_t \% (k + 1) = m_t > 0$， 我们先看已经选择改变过了的这 $m_x$ 个数当中（第 $t$ 位为 1 的有 $A$ 个， 为 0 的有 $B$ 个）， 则：  
> 
> 1. $m_t \leq A$， 直接在这 $A$ 个 1 里面任意选择 $m_t$ 个变成 0 就好了。
> 2. $k + 1 - m_t \leq B$， 直接在这 $B$ 个 0 里面任意选择 $k + 1 - m_t$ 个变成 1 就好了。
> 3. 上述两种情况都不成立时， 先把这 $A$ 个 1 全部变成 0， 再选 $m_t - A$ 个这 $m_x$ 个数之外且第 $t$ 位为 1 的数并把第 $t$ 位上的 1 变成 0。 此时我们总共选了 $m_x + m_t - A = B + m_t < k + 1$ 个数是符合条件的。
> 
> 根据以上步骤操作， N 态在一次移动后总能达到 P 态。

## Anti-Nim

### 概述

和传统 Nim 的游戏规则一样，不过是拿走最后一个石子的输。

### 分类讨论

首先把每堆石子分为两类 $A$ 类是这堆石子里只有一颗石子， $B$ 类是这堆石子里有大于 1 颗的石子

1. 最简单的情况是每堆都是 $A$ 类，此时直接根据奇偶判断就好了
2. 当只有一堆 $B$ 类时，先手必胜，因为先手可以通过唯一的一堆 $B$ 类控制 $A$ 类数量的奇偶。
3. 当有大于两堆的 $B$ 类时，还分如下情况：  
    1. 当 $nim \not = 0$ （尼姆和不为 0 ）时，根据传统的 Nim 游戏的套路先手一定可以让次态 $nim = 0$ 且 $B$ 类的数量仍然大于两堆（下面一种情况）， 因为当只有一堆 $B$ 类石子时， $nim$ 不可能为 0。
    2. 当 $nim = 0$ 时， 先手操作后 $nim \not = 0 $，且如果还剩一堆 $B$ 类，那后手赢了，否则后手又回到上一种情况。在多轮反复后，先手的操作肯定只能将两个 $B$ 类拿到只剩下一个 $B$ 类，此时后手就赢了。

    综合以上两点， 当 $nim = 0$ 时是 P 态，而当 $nim \not = 0 $ 时是 N 态。

### 结论

根据分类讨论的情况，我们可以得出以下结论：  
先手必胜当且仅当以下两种情况之一：  
1. 有偶数堆石子且全部都是 $A$ 类
2. 至少有一堆 $B$ 类且 $nim \not = 0$